import sys

f = open("mem_template", 'rb')
write_address_frame = f.read()
f.close()



f = open(sys.argv[1], 'rb') # was fullout.bin
content = f.read()
f.close()

curr_index = 0xa000 + 215 - 2

index = 0
end = 0


while end == 0 and len(content) > 0:

	if index == 0:
		o = write_address_frame[:0x16b] + curr_index.to_bytes(2, byteorder='little') + write_address_frame[0x16b+2:]
	
	else:
		c = ""
		if len(content) > 215:
			c = content[len(content)-215:]
			#token = b"TOKEN" + str(index).encode('utf-8')
			#c = token + c[len(token):]
			content = content[:len(content)-215]
		else:
			c = content
			print("straggler len", len(c), hex(curr_index))
			for j in range(0, 215 - len(content)):
				c = b"A" + c
			end = 1
			#curr_index = 0x61ed	
		
		
		o = write_address_frame[:0x16b] + curr_index.to_bytes(2, byteorder='little') + c + write_address_frame[0x16b+2+215:]
	
	index+=1	
	curr_index -=215
	print(hex(curr_index))
	f = open(str(index + 2) + "_write_address_and_write", 'wb')
	f.write(o)
	f.close() #73a0


